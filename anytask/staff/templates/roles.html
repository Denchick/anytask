{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "nastroyki_roley" %}{% endblock %}

{% block scripts %}
    {% include "roles_js.html" %}

    <link href="{{ STATIC_URL }}roles.css" rel='stylesheet' />
{% endblock %}

{% block navbar %}
    <ul class="nav navbar-nav">
        <li class="nav-item">
            <a class="nav-link" href="{% url staff.views.staff_page %}">{% trans "backoffice" %}</a>
        </li>
        <li class="nav-item">
            <a class="nav-link active" href="">{% trans "nastroyki_roley" %}</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url staff.views.roles_assign_page %}">{% trans "izmeneniye_dostupov_polzovateley" %}</a>
        </li>
    </ul>
{% endblock navbar %}

{% block content %}
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title">{% trans "nastroyki_roley" %}</h5>
                    <ul class="nav nav-pills" id="nav_schools">
                        {% for roles_table in roles_tables %}
                            <li class="nav-item">
                                <span
                                        class="nav-link"
                                        data-toggle="pill"
                                        data-table="#table_roles_{{ roles_table.school_info.id }}"
                                        data-school_id="{{ roles_table.school_info.id }}"
                                        href="#school_{{ roles_table.school_info.id }}"
                                        role="tab"
                                        aria-controls="school_{{ roles_table.school_info.id }}"
                                >{{ roles_table.school_info.name }}</span>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
                <div class="card-block">
                    <div class="row">
                        <div class="col-xs-12 btns-managment">
                            <button type="button" class="btn btn-secondary" id="btn_add_role" disabled="disabled">{% trans "dobavit_rol" %}</button>
                            <button type="button" class="btn btn-primary hidden" id="btn_save"
                                    data-new_counter="0"
                                    data-csrf_token="{{ csrf_token }}"
                                    data-reset_text="{% trans "sohranit_izmenenija" %}"
                                    data-loading_text="<span class='fa fa-circle-o-notch fa-spin'></span> {% trans "sohranenie" %}"
                                    disabled="disabled">{% trans "sohranit_izmenenija" %}</button>
                        </div>
                    </div>

                    <div class="tab-content">
                        {% for roles_table in roles_tables %}
                            <div class="tab-pane fade" id="school_{{ roles_table.school_info.id }}" role="tabpanel">
                                <div class="row">
                                    <div class="loading-table-img">
                                        <div class="col-xs-12">
                                            <span class="fa fa-circle-o-notch fa-spin fa-3x fa-fw loading"></span>
                                        </div>
                                    </div>
                                    <div class="table-container">
                                        <div class="col-xs-12">
                                            <table class="table table-striped table-bordered table-roles" id="table_roles_{{ roles_table.school_info.id }}">
                                                <thead>
                                                <tr>
                                                    <th class="disable-ordering">{% trans 'dostupy' %}</th>
                                                    <th></th>
                                                    {% for th in roles_table.roles_info.header %}
                                                        <th class="disable-ordering centered role-header" data-role_id="{{ th.id }}" data-name="{{ th.name }}">
                                                            <span class="role-header-name">{{ th.name }}</span>
                                                            <span class="fa fa-pencil btn-edit-role" aria-hidden="true"></span>
                                                            <span class="fa fa-trash-o btn-delete-role" aria-hidden="true"></span>
                                                        </th>
                                                    {% endfor %}
                                                </tr>
                                                </thead>
                                                <tbody>
                                                {% for perm_id, tr in roles_table.roles_info.body.iteritems %}
                                                    <tr data-perm_id="{{ perm_id }}" class="perm-row">
                                                        {% for td in tr %}
                                                            <td data-perm_id="{{ perm_id }}" data-role_id="{{ td.role_id }}" class="{% if td.is_checkbox %}cell-perm-checkbox centered{% endif %} {% if td.disabled and not user.is_superuser %}disabled{% endif %}">
                                                                {% if td.is_checkbox %}
                                                                    <input type="checkbox" class="perm-checkbox" {% if td.selected %}checked="checked"{% endif %} {% if td.disabled and not user.is_superuser %}data-disabled="true" disabled="disabled"{% endif %}>
                                                                {% else %}
                                                                    {{ td.name }}
                                                                {% endif %}
                                                            </td>
                                                        {% endfor %}
                                                    </tr>
                                                {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modal_role_edit" tabindex="-1" role="dialog" aria-labelledby="modal-title" aria-hidden="true">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="modal_role_edit_header"></h4>
                </div>
                <div class="modal-body">
                    <form id="modal_role_edit_form">
                        <div class="form-group row">
                            <label class="col-xs-4 form-control-label" for="modal_role_edit_name">{% trans "nazvanie" %}</label>
                            <div class="col-xs-8 controls" >
                                <input class="form-control" id='modal_role_edit_name' name='modal_role_edit_name' type='text' autocomplete="off" />
                                <small class="text-help" id="modal_role_edit_name_error_text"></small>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-xs-4 form-control-label" for="modal_role_edit_inherit"> {% trans "bazovaya_rol" %}</label>
                            <div class="col-xs-8 controls">
                                <select class="form-control" id='modal_role_edit_inherit' name="modal_role_edit_inherit">
                                    <option value="-1">---</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-dismiss="modal">{% trans "zakryt" %}</button>
                    <button class="btn btn-primary" id="modal_role_edit_ok">{% trans "dobavit" %}</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modal_role_delete" tabindex="-1" role="dialog" aria-labelledby="modal-title" aria-hidden="true">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="modal_role_delete_header">{% trans 'udalit_rol' %}&nbsp;"<span></span>"</h4>
                </div>
                <div class="modal-body">
                    <p>{% trans "udalit_rol_info" %}</p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-dismiss="modal">{% trans "zakryt" %}</button>
                    <button class="btn btn-danger" id="modal_role_delete_ok">{% trans "udalit" %}</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
